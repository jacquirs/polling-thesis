kalman filtering & smoothing analysis — within-day aggregated version
started: 2026-02-16 23:05:03
log file: output/kalman_daily_aggregated_log_20260216_230503.txt
time windows: [None, 200, 107]

======================================================================
======================================================================
ANALYZING TIME WINDOW: ALL DATA
======================================================================
======================================================================

======================================================================
ANCHORED MODE: bias decomposition conditional on known outcome (ALL DATA)
======================================================================
national polls loaded: 826 questions from 496 polls
date range: 2021-05-18 to 2024-11-04
true margin (constant across rows): 1.472 pp
poll margin range: -15.0 to 13.0 pp
mean poll margin: -0.766 pp

sanity check — unique true_margin values: [1.47233556]

within-day aggregation complete:
  observations before: 826 (individual poll questions)
  observations after:  222 (one per unique end_date)
  unique days:         222 -> 222
  mean polls per day:  3.7
  mean combined n:     11109
  mean combined var:   3.1354 pp^2
  mean individual var (pre-agg): 5.7312 pp^2
  variance reduction factor: 1.8x

election result appended: margin = 1.472 pp on 2024-11-05

estimating sigma2_u via grid search mle...
  sigma2_u estimated (two-stage grid mle): 0.456235 per day
  interpretation: true opinion can move ~0.675 pp/day (1 sd)

============================================================
polling bias decomposition — national (trump margin, anchored)
============================================================

true margin (certified result): 1.472 pp

--- overall poll error ---
  mean poll margin:          1.069 pp
  mean total error:          -0.404 pp
  sd of total error:         5.043 pp

--- decomposition (means) ---
  mean systematic bias:      -0.500 pp
  mean |sampling noise|:     1.437 pp

--- variance decomposition ---
  var(total error):          25.4351
  var(systematic bias):      16.5049  (64.9%)
  var(sampling noise):       5.6333  (22.1%)

figure saved to: figures/kalman_agg_bias_anchored_all_data.png
results exported to: data/kalman_agg_results_anchored_all_data.csv

======================================================================
UNANCHORED MODE: real-time opinion trajectory from polls alone (ALL DATA)
======================================================================
national polls loaded: 826 questions from 496 polls
date range: 2021-05-18 to 2024-11-04
true margin (constant across rows): 1.472 pp
poll margin range: -15.0 to 13.0 pp
mean poll margin: -0.766 pp

within-day aggregation complete:
  observations before: 826 (individual poll questions)
  observations after:  222 (one per unique end_date)
  unique days:         222 -> 222
  mean polls per day:  3.7
  mean combined n:     11109
  mean combined var:   3.1354 pp^2
  mean individual var (pre-agg): 5.7312 pp^2
  variance reduction factor: 1.8x

skipping election result anchor (unanchored mode)
true margin: 1.472 pp (not used as constraint)

estimating sigma2_u via grid search mle...
  sigma2_u estimated (two-stage grid mle): 0.414574 per day
  interpretation: true opinion can move ~0.644 pp/day (1 sd)

============================================================
polling opinion trajectory — national (trump margin, unanchored)
============================================================

true margin (certified result): 1.472 pp

--- overall poll error ---
  mean poll margin:          1.069 pp
  mean total error:          -0.404 pp
  sd of total error:         5.043 pp

--- decomposition (means) ---
  final forecast error:      -1.776 pp
  mean smoothed-poll gap:    1.463 pp
  mean |sampling noise|:     1.463 pp

figure saved to: figures/kalman_agg_trajectory_unanchored_all_data.png
results exported to: data/kalman_agg_results_unanchored_all_data.csv

======================================================================
COMPARISON: anchored vs unanchored (ALL DATA)
======================================================================
sigma2_u (anchored):   0.456235
sigma2_u (unanchored): 0.414574
ratio (anchored/unanchored): 1.100

final smoothed estimate (anchored):   0.609 pp
final smoothed estimate (unanchored): -0.304 pp
true margin:                          1.472 pp
unanchored forecast error:            -1.776 pp
anchored terminal adjustment:         0.863 pp

======================================================================
======================================================================
ANALYZING TIME WINDOW: LAST 200 DAYS
======================================================================
======================================================================

======================================================================
ANCHORED MODE: bias decomposition conditional on known outcome (LAST 200 DAYS)
======================================================================
date filter applied: keeping polls from 2024-04-19 onward
  polls before filter: 826
  polls after filter:  684
  polls dropped:       142
national polls loaded: 684 questions from 394 polls
date range: 2024-04-22 to 2024-11-04
true margin (constant across rows): 1.472 pp
poll margin range: -8.0 to 11.0 pp
mean poll margin: -1.828 pp

sanity check — unique true_margin values: [1.47233556]

within-day aggregation complete:
  observations before: 684 (individual poll questions)
  observations after:  123 (one per unique end_date)
  unique days:         123 -> 123
  mean polls per day:  5.6
  mean combined n:     18403
  mean combined var:   1.1938 pp^2
  mean individual var (pre-agg): 5.5495 pp^2
  variance reduction factor: 4.6x

election result appended: margin = 1.472 pp on 2024-11-05

estimating sigma2_u via grid search mle...
  sigma2_u estimated (two-stage grid mle): 0.455182 per day
  interpretation: true opinion can move ~0.675 pp/day (1 sd)

============================================================
polling bias decomposition — national (trump margin, anchored)
============================================================

true margin (certified result): 1.472 pp

--- overall poll error ---
  mean poll margin:          -2.053 pp
  mean total error:          -3.526 pp
  sd of total error:         2.972 pp

--- decomposition (means) ---
  mean systematic bias:      -3.445 pp
  mean |sampling noise|:     0.585 pp

--- variance decomposition ---
  var(total error):          8.8331
  var(systematic bias):      7.5739  (85.7%)
  var(sampling noise):       0.8860  (10.0%)

figure saved to: figures/kalman_agg_bias_anchored_last_200_days.png
results exported to: data/kalman_agg_results_anchored_last_200_days.csv

======================================================================
UNANCHORED MODE: real-time opinion trajectory from polls alone (LAST 200 DAYS)
======================================================================
date filter applied: keeping polls from 2024-04-19 onward
  polls before filter: 826
  polls after filter:  684
  polls dropped:       142
national polls loaded: 684 questions from 394 polls
date range: 2024-04-22 to 2024-11-04
true margin (constant across rows): 1.472 pp
poll margin range: -8.0 to 11.0 pp
mean poll margin: -1.828 pp

within-day aggregation complete:
  observations before: 684 (individual poll questions)
  observations after:  123 (one per unique end_date)
  unique days:         123 -> 123
  mean polls per day:  5.6
  mean combined n:     18403
  mean combined var:   1.1938 pp^2
  mean individual var (pre-agg): 5.5495 pp^2
  variance reduction factor: 4.6x

skipping election result anchor (unanchored mode)
true margin: 1.472 pp (not used as constraint)

estimating sigma2_u via grid search mle...
  sigma2_u estimated (two-stage grid mle): 0.411692 per day
  interpretation: true opinion can move ~0.642 pp/day (1 sd)

============================================================
polling opinion trajectory — national (trump margin, unanchored)
============================================================

true margin (certified result): 1.472 pp

--- overall poll error ---
  mean poll margin:          -2.053 pp
  mean total error:          -3.526 pp
  sd of total error:         2.972 pp

--- decomposition (means) ---
  final forecast error:      -1.778 pp
  mean smoothed-poll gap:    0.602 pp
  mean |sampling noise|:     0.602 pp

figure saved to: figures/kalman_agg_trajectory_unanchored_last_200_days.png
results exported to: data/kalman_agg_results_unanchored_last_200_days.csv

======================================================================
COMPARISON: anchored vs unanchored (LAST 200 DAYS)
======================================================================
sigma2_u (anchored):   0.455182
sigma2_u (unanchored): 0.411692
ratio (anchored/unanchored): 1.106

final smoothed estimate (anchored):   0.609 pp
final smoothed estimate (unanchored): -0.306 pp
true margin:                          1.472 pp
unanchored forecast error:            -1.778 pp
anchored terminal adjustment:         0.863 pp

======================================================================
======================================================================
ANALYZING TIME WINDOW: LAST 107 DAYS
======================================================================
======================================================================

======================================================================
ANCHORED MODE: bias decomposition conditional on known outcome (LAST 107 DAYS)
======================================================================
date filter applied: keeping polls from 2024-07-21 onward
  polls before filter: 826
  polls after filter:  649
  polls dropped:       177
national polls loaded: 649 questions from 367 polls
date range: 2024-07-21 to 2024-11-04
true margin (constant across rows): 1.472 pp
poll margin range: -8.0 to 8.0 pp
mean poll margin: -2.117 pp

sanity check — unique true_margin values: [1.47233556]

within-day aggregation complete:
  observations before: 649 (individual poll questions)
  observations after:  105 (one per unique end_date)
  unique days:         105 -> 105
  mean polls per day:  6.2
  mean combined n:     21070
  mean combined var:   0.5814 pp^2
  mean individual var (pre-agg): 5.4908 pp^2
  variance reduction factor: 9.4x

election result appended: margin = 1.472 pp on 2024-11-05

estimating sigma2_u via grid search mle...
  sigma2_u estimated (two-stage grid mle): 0.484755 per day
  interpretation: true opinion can move ~0.696 pp/day (1 sd)

============================================================
polling bias decomposition — national (trump margin, anchored)
============================================================

true margin (certified result): 1.472 pp

--- overall poll error ---
  mean poll margin:          -3.025 pp
  mean total error:          -4.498 pp
  sd of total error:         1.662 pp

--- decomposition (means) ---
  mean systematic bias:      -4.430 pp
  mean |sampling noise|:     0.405 pp

--- variance decomposition ---
  var(total error):          2.7620
  var(systematic bias):      2.0671  (74.8%)
  var(sampling noise):       0.3564  (12.9%)

figure saved to: figures/kalman_agg_bias_anchored_last_107_days.png
results exported to: data/kalman_agg_results_anchored_last_107_days.csv

======================================================================
UNANCHORED MODE: real-time opinion trajectory from polls alone (LAST 107 DAYS)
======================================================================
date filter applied: keeping polls from 2024-07-21 onward
  polls before filter: 826
  polls after filter:  649
  polls dropped:       177
national polls loaded: 649 questions from 367 polls
date range: 2024-07-21 to 2024-11-04
true margin (constant across rows): 1.472 pp
poll margin range: -8.0 to 8.0 pp
mean poll margin: -2.117 pp

within-day aggregation complete:
  observations before: 649 (individual poll questions)
  observations after:  105 (one per unique end_date)
  unique days:         105 -> 105
  mean polls per day:  6.2
  mean combined n:     21070
  mean combined var:   0.5814 pp^2
  mean individual var (pre-agg): 5.4908 pp^2
  variance reduction factor: 9.4x

skipping election result anchor (unanchored mode)
true margin: 1.472 pp (not used as constraint)

estimating sigma2_u via grid search mle...
  sigma2_u estimated (two-stage grid mle): 0.439550 per day
  interpretation: true opinion can move ~0.663 pp/day (1 sd)

============================================================
polling opinion trajectory — national (trump margin, unanchored)
============================================================

true margin (certified result): 1.472 pp

--- overall poll error ---
  mean poll margin:          -3.025 pp
  mean total error:          -4.498 pp
  sd of total error:         1.662 pp

--- decomposition (means) ---
  final forecast error:      -1.761 pp
  mean smoothed-poll gap:    0.422 pp
  mean |sampling noise|:     0.422 pp

figure saved to: figures/kalman_agg_trajectory_unanchored_last_107_days.png
results exported to: data/kalman_agg_results_unanchored_last_107_days.csv

======================================================================
COMPARISON: anchored vs unanchored (LAST 107 DAYS)
======================================================================
sigma2_u (anchored):   0.484755
sigma2_u (unanchored): 0.439550
ratio (anchored/unanchored): 1.103

final smoothed estimate (anchored):   0.601 pp
final smoothed estimate (unanchored): -0.289 pp
true margin:                          1.472 pp
unanchored forecast error:            -1.761 pp
anchored terminal adjustment:         0.871 pp

======================================================================
analysis completed: 2026-02-16 23:06:02
log saved to: output/kalman_daily_aggregated_log_20260216_230503.txt
