kalman filtering & smoothing analysis — within-day aggregated version
started: 2026-02-25 00:27:48
log file: output/kalman/kalman_daily_aggregated_log_20260225_002748.txt
time windows: [None, 200, 107]

======================================================================
======================================================================
ANALYZING TIME WINDOW: ALL DATA
======================================================================
======================================================================

======================================================================
ANCHORED MODE: bias decomposition conditional on known outcome (ALL DATA)
======================================================================
national polls loaded: 853 questions from 515 polls
date range: 2021-05-18 to 2024-11-04
true margin (constant across rows): 1.472 pp
poll margin range: -15.0 to 13.0 pp
mean poll margin: -0.801 pp

sanity check — unique true_margin values: [1.47233556]

within-day aggregation complete:
  observations before: 853 (individual poll questions)
  observations after:  226 (one per unique end_date)
  unique days:         226 -> 226
  mean polls per day:  3.8
  mean combined n:     11370
  mean combined var:   3.1469 pp^2
  mean individual var (pre-agg): 5.7239 pp^2
  variance reduction factor: 1.8x

election result appended: margin = 1.472 pp on 2024-11-05

estimating sigma2_u via grid search mle...
  sigma2_u estimated (two-stage grid mle): 0.419433 per day
  interpretation: true opinion can move ~0.648 pp/day (1 sd)

============================================================
polling bias decomposition — national (trump margin, anchored)
============================================================

true margin (certified result): 1.472 pp

--- overall poll error ---
  mean poll margin:          1.067 pp
  mean total error:          -0.406 pp
  sd of total error:         5.035 pp

--- decomposition (means) ---
  mean systematic bias:      -0.507 pp
  mean |sampling noise|:     1.442 pp

--- variance decomposition ---
  var(total error):          25.3516
  var(systematic bias):      16.5047  (65.1%)
  var(sampling noise):       5.6403  (22.2%)

figure saved to: figures/kalman_agg_bias_anchored_all_data.png
results exported to: data/kalman_agg_results_anchored_all_data.csv

======================================================================
UNANCHORED MODE: real-time opinion trajectory from polls alone (ALL DATA)
======================================================================
national polls loaded: 853 questions from 515 polls
date range: 2021-05-18 to 2024-11-04
true margin (constant across rows): 1.472 pp
poll margin range: -15.0 to 13.0 pp
mean poll margin: -0.801 pp

within-day aggregation complete:
  observations before: 853 (individual poll questions)
  observations after:  226 (one per unique end_date)
  unique days:         226 -> 226
  mean polls per day:  3.8
  mean combined n:     11370
  mean combined var:   3.1469 pp^2
  mean individual var (pre-agg): 5.7239 pp^2
  variance reduction factor: 1.8x

skipping election result anchor (unanchored mode)
true margin: 1.472 pp (not used as constraint)

estimating sigma2_u via grid search mle...
  sigma2_u estimated (two-stage grid mle): 0.377500 per day
  interpretation: true opinion can move ~0.614 pp/day (1 sd)

============================================================
polling opinion trajectory — national (trump margin, unanchored)
============================================================

true margin (certified result): 1.472 pp

--- overall poll error ---
  mean poll margin:          1.067 pp
  mean total error:          -0.406 pp
  sd of total error:         5.035 pp

--- decomposition (means) ---
  final forecast error:      -1.801 pp
  mean smoothed-poll gap:    1.468 pp
  mean |sampling noise|:     1.468 pp

figure saved to: figures/kalman_agg_trajectory_unanchored_all_data.png
results exported to: data/kalman_agg_results_unanchored_all_data.csv

======================================================================
COMPARISON: anchored vs unanchored (ALL DATA)
======================================================================
sigma2_u (anchored):   0.419433
sigma2_u (unanchored): 0.377500
ratio (anchored/unanchored): 1.111

final smoothed estimate (anchored):   0.620 pp
final smoothed estimate (unanchored): -0.328 pp
true margin:                          1.472 pp
unanchored forecast error:            -1.801 pp
anchored terminal adjustment:         0.852 pp

======================================================================
======================================================================
ANALYZING TIME WINDOW: LAST 200 DAYS
======================================================================
======================================================================

======================================================================
ANCHORED MODE: bias decomposition conditional on known outcome (LAST 200 DAYS)
======================================================================
date filter applied: keeping polls from 2024-04-19 onward
  polls before filter: 861
  polls after filter:  718
  polls dropped:       143
national polls loaded: 710 questions from 412 polls
date range: 2024-04-22 to 2024-11-04
true margin (constant across rows): 1.472 pp
poll margin range: -8.0 to 11.0 pp
mean poll margin: -1.840 pp

sanity check — unique true_margin values: [1.47233556]

within-day aggregation complete:
  observations before: 710 (individual poll questions)
  observations after:  126 (one per unique end_date)
  unique days:         126 -> 126
  mean polls per day:  5.6
  mean combined n:     18778
  mean combined var:   1.2129 pp^2
  mean individual var (pre-agg): 5.5425 pp^2
  variance reduction factor: 4.6x

election result appended: margin = 1.472 pp on 2024-11-05

estimating sigma2_u via grid search mle...
  sigma2_u estimated (two-stage grid mle): 0.420318 per day
  interpretation: true opinion can move ~0.648 pp/day (1 sd)

============================================================
polling bias decomposition — national (trump margin, anchored)
============================================================

true margin (certified result): 1.472 pp

--- overall poll error ---
  mean poll margin:          -2.022 pp
  mean total error:          -3.494 pp
  sd of total error:         3.009 pp

--- decomposition (means) ---
  mean systematic bias:      -3.422 pp
  mean |sampling noise|:     0.593 pp

--- variance decomposition ---
  var(total error):          9.0541
  var(systematic bias):      7.7601  (85.7%)
  var(sampling noise):       0.8800  (9.7%)

figure saved to: figures/kalman_agg_bias_anchored_last_200_days.png
results exported to: data/kalman_agg_results_anchored_last_200_days.csv

======================================================================
UNANCHORED MODE: real-time opinion trajectory from polls alone (LAST 200 DAYS)
======================================================================
date filter applied: keeping polls from 2024-04-19 onward
  polls before filter: 861
  polls after filter:  718
  polls dropped:       143
national polls loaded: 710 questions from 412 polls
date range: 2024-04-22 to 2024-11-04
true margin (constant across rows): 1.472 pp
poll margin range: -8.0 to 11.0 pp
mean poll margin: -1.840 pp

within-day aggregation complete:
  observations before: 710 (individual poll questions)
  observations after:  126 (one per unique end_date)
  unique days:         126 -> 126
  mean polls per day:  5.6
  mean combined n:     18778
  mean combined var:   1.2129 pp^2
  mean individual var (pre-agg): 5.5425 pp^2
  variance reduction factor: 4.6x

skipping election result anchor (unanchored mode)
true margin: 1.472 pp (not used as constraint)

estimating sigma2_u via grid search mle...
  sigma2_u estimated (two-stage grid mle): 0.376887 per day
  interpretation: true opinion can move ~0.614 pp/day (1 sd)

============================================================
polling opinion trajectory — national (trump margin, unanchored)
============================================================

true margin (certified result): 1.472 pp

--- overall poll error ---
  mean poll margin:          -2.022 pp
  mean total error:          -3.494 pp
  sd of total error:         3.009 pp

--- decomposition (means) ---
  final forecast error:      -1.801 pp
  mean smoothed-poll gap:    0.611 pp
  mean |sampling noise|:     0.611 pp

figure saved to: figures/kalman_agg_trajectory_unanchored_last_200_days.png
results exported to: data/kalman_agg_results_unanchored_last_200_days.csv

======================================================================
COMPARISON: anchored vs unanchored (LAST 200 DAYS)
======================================================================
sigma2_u (anchored):   0.420318
sigma2_u (unanchored): 0.376887
ratio (anchored/unanchored): 1.115

final smoothed estimate (anchored):   0.620 pp
final smoothed estimate (unanchored): -0.329 pp
true margin:                          1.472 pp
unanchored forecast error:            -1.801 pp
anchored terminal adjustment:         0.853 pp

======================================================================
======================================================================
ANALYZING TIME WINDOW: LAST 107 DAYS
======================================================================
======================================================================

======================================================================
ANCHORED MODE: bias decomposition conditional on known outcome (LAST 107 DAYS)
======================================================================
date filter applied: keeping polls from 2024-07-21 onward
  polls before filter: 861
  polls after filter:  682
  polls dropped:       179
national polls loaded: 674 questions from 384 polls
date range: 2024-07-21 to 2024-11-04
true margin (constant across rows): 1.472 pp
poll margin range: -8.0 to 8.0 pp
mean poll margin: -2.129 pp

sanity check — unique true_margin values: [1.47233556]

within-day aggregation complete:
  observations before: 674 (individual poll questions)
  observations after:  107 (one per unique end_date)
  unique days:         107 -> 107
  mean polls per day:  6.3
  mean combined n:     21624
  mean combined var:   0.5435 pp^2
  mean individual var (pre-agg): 5.4807 pp^2
  variance reduction factor: 10.1x

election result appended: margin = 1.472 pp on 2024-11-05

estimating sigma2_u via grid search mle...
  sigma2_u estimated (two-stage grid mle): 0.448094 per day
  interpretation: true opinion can move ~0.669 pp/day (1 sd)

============================================================
polling bias decomposition — national (trump margin, anchored)
============================================================

true margin (certified result): 1.472 pp

--- overall poll error ---
  mean poll margin:          -3.036 pp
  mean total error:          -4.508 pp
  sd of total error:         1.647 pp

--- decomposition (means) ---
  mean systematic bias:      -4.444 pp
  mean |sampling noise|:     0.412 pp

--- variance decomposition ---
  var(total error):          2.7138
  var(systematic bias):      2.0407  (75.2%)
  var(sampling noise):       0.3464  (12.8%)

figure saved to: figures/kalman_agg_bias_anchored_last_107_days.png
results exported to: data/kalman_agg_results_anchored_last_107_days.csv

======================================================================
UNANCHORED MODE: real-time opinion trajectory from polls alone (LAST 107 DAYS)
======================================================================
date filter applied: keeping polls from 2024-07-21 onward
  polls before filter: 861
  polls after filter:  682
  polls dropped:       179
national polls loaded: 674 questions from 384 polls
date range: 2024-07-21 to 2024-11-04
true margin (constant across rows): 1.472 pp
poll margin range: -8.0 to 8.0 pp
mean poll margin: -2.129 pp

within-day aggregation complete:
  observations before: 674 (individual poll questions)
  observations after:  107 (one per unique end_date)
  unique days:         107 -> 107
  mean polls per day:  6.3
  mean combined n:     21624
  mean combined var:   0.5435 pp^2
  mean individual var (pre-agg): 5.4807 pp^2
  variance reduction factor: 10.1x

skipping election result anchor (unanchored mode)
true margin: 1.472 pp (not used as constraint)

estimating sigma2_u via grid search mle...
  sigma2_u estimated (two-stage grid mle): 0.402490 per day
  interpretation: true opinion can move ~0.634 pp/day (1 sd)

============================================================
polling opinion trajectory — national (trump margin, unanchored)
============================================================

true margin (certified result): 1.472 pp

--- overall poll error ---
  mean poll margin:          -3.036 pp
  mean total error:          -4.508 pp
  sd of total error:         1.647 pp

--- decomposition (means) ---
  final forecast error:      -1.784 pp
  mean smoothed-poll gap:    0.430 pp
  mean |sampling noise|:     0.430 pp

figure saved to: figures/kalman_agg_trajectory_unanchored_last_107_days.png
results exported to: data/kalman_agg_results_unanchored_last_107_days.csv

======================================================================
COMPARISON: anchored vs unanchored (LAST 107 DAYS)
======================================================================
sigma2_u (anchored):   0.448094
sigma2_u (unanchored): 0.402490
ratio (anchored/unanchored): 1.113

final smoothed estimate (anchored):   0.611 pp
final smoothed estimate (unanchored): -0.312 pp
true margin:                          1.472 pp
unanchored forecast error:            -1.784 pp
anchored terminal adjustment:         0.861 pp

======================================================================
analysis completed: 2026-02-25 00:27:53
log saved to: output/kalman/kalman_daily_aggregated_log_20260225_002748.txt
